<!DOCTYPE html>
<html lang="en">
<!-- How this file works: small billing/shipping/payment form; shows summary from localStorage; basic payment checks; clears cart. -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout — Sip Happens</title>
  <link rel="stylesheet" href="./css/style.css" />
  <link rel="icon" href="./images/favicon.png" />
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <!-- shared header -->
  <header class="header">
    <div class="container">
      <nav class="nav" aria-label="Primary">
        <a class="logo" href="index.html" style="font-weight:800">Sip Happens</a>
        <div class="nav-links">
          <a href="index.html">Home</a>
		  <a href="Login.html">Login</a>
		  <a href="Cart.html">Cart</a>
		  <a href="Admin.html">Admin</a>
        </div>
      </nav>
    </div>
  </header>

  <main id="main" class="container">
    <h1>Checkout</h1>

    <div class="checkout" style="margin-top:12px">
      <!-- form column -->
      <form id="form" novalidate>
        <h2>Billing</h2>
        <div class="field">
			<label for="bname">Full name</label>
			<input id="bname" class="input" required>
		</div>
        <div class="field">
			<label for="bemail">Email</label>
			<input id="bemail" class="input" type="email" required>
		</div>
        <div class="field">
			<label for="baddr">Address</label>
			<input id="baddr" class="input" required>
		</div>
      	<div class="field">
			<label for="bcity">City</label>
			<input id="bcity" class="input" required>
		</div>
        <div class="field">
			<label for="bzip">Postcode</label>
			<input id="bzip" class="input" required>
		</div>

        <div class="field" style="margin-top:8px">
          <input id="same" type="checkbox"> <label for="same">Shipping same as billing</label>
        </div>

        <!-- shipping hides if "same" is ticked -->
        <div id="shipBox" style="margin-top:8px">
          <h2>Shipping</h2>
          <div class="field"><label for="saddr">Address</label><input id="saddr" class="input" required></div>
          <div class="field"><label for="scity">City</label><input id="scity" class="input" required></div>
          <div class="field"><label for="szip">Postcode</label><input id="szip" class="input" required></div>
        </div>

        <h2 style="margin-top:8px">Payment</h2>
        <div class="field"><label for="card">Card number</label><input id="card" class="input" type="password" inputmode="numeric" required></div>
        <div class="field"><label for="exp">Expiry (MM/YY)</label><input id="exp" class="input" type="password" inputmode="numeric" required></div>
        <div class="field"><label for="cvc">CVC</label><input id="cvc" class="input" type="password" inputmode="numeric" required></div>

        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" type="submit">Place order</button>
          <a class="btn outline" href="Cart.html">Back to cart</a>
        </div>
      </form>

      <!-- summary column -->
      <aside>
        <h2>Order Summary</h2>
        <div id="lines" class="grid" style="margin-top:8px"></div>   <!-- line items -->
        <p style="margin-top:8px">Subtotal: $<span id="sub">0.00</span></p>
        <p>Shipping: $<span id="ship">0.00</span></p>
        <p style="font-weight:700">Total: $<span id="tot">0.00</span></p>
      </aside>
    </div>
  </main>

  <!-- shared footer -->
  <footer class="footer">
    <div class="container" style="text-align:center">
      © <span id="year"></span> Sip Happens • <a href="terms.html">Terms</a> • <a href="shipping.html">Shipping</a> • <a href="policy.html">Privacy</a>
    </div>
  </footer>
  <script>/* footer-year */ document.getElementById('year').textContent=new Date().getFullYear();</script>

  <script>
    // read cart + render summary
    const getCart=()=>JSON.parse(localStorage.getItem('cart')||'[]');
    const money=n=>(Math.round(n*100)/100).toFixed(2);
    function renderSummary(){
      const wrap=document.getElementById('lines'); wrap.innerHTML='';
      const cart=getCart(); let sub=0;
      cart.forEach(it=>{ sub+=it.price*it.qty; wrap.insertAdjacentHTML('beforeend',`<div class="card"><div>${it.name} × ${it.qty}</div><div>$${money(it.price*it.qty)}</div></div>`); });
      document.getElementById('sub').textContent=money(sub);
      const ship=cart.length?6:0; document.getElementById('ship').textContent=money(ship);
      document.getElementById('tot').textContent=money(sub+ship);
    }
    renderSummary();

    // toggle shipping block
    const same=document.getElementById('same'), shipBox=document.getElementById('shipBox');
    function sync(){ shipBox.style.display=same.checked?'none':'block'; shipBox.querySelectorAll('input').forEach(i=>i.required=!same.checked); }
    same.addEventListener('change',sync); sync();

    // simple input masking
    const card=document.getElementById('card'), exp=document.getElementById('exp'), cvc=document.getElementById('cvc');
    card.addEventListener('input',()=>{ let v=card.value.replace(/\D/g,'').slice(0,19); card.value=v.replace(/(.{4})/g,'$1 ').trim(); });
    exp.addEventListener('input',()=>{ let v=exp.value.replace(/\D/g,'').slice(0,4); if(v.length>=3) v=v.slice(0,2)+'/'+v.slice(2); exp.value=v; });
    cvc.addEventListener('input',()=>{ cvc.value=cvc.value.replace(/\D/g,'').slice(0,4); });

    // tiny Luhn check (sanity only)
    function luhnOk(d){let s=0,a=false;for(let i=d.length-1;i>=0;i--){let n=+d[i];if(a){n*=2;if(n>9)n-=9}s+=n;a=!a}return s%10===0}

    // submit: validate & clear cart
    document.getElementById('form').addEventListener('submit',e=>{
      e.preventDefault();
      const raw=card.value.replace(/\s/g,'');
      if(raw.length<12||!luhnOk(raw)){ alert('Enter a valid card number.'); return; }
      if(!/^(0[1-9]|1[0-2])\/\d{2}$/.test(exp.value)){ alert('Use MM/YY.'); return; }
      if(cvc.value.length<3){ alert('Invalid CVC.'); return; }
      alert('Order placed — thank you!');
      localStorage.removeItem('cart');
      location.href='index.html';
    });
  </script>
</body>
</html>